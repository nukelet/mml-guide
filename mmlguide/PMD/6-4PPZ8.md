# PPZ8 (PVI,PZI)

PPZ8 is a driver that synthesizes up to 8 PCM channels using the 86PCM, with soft panning possibilities and no memory limit aside from the user's PC98 setup.

It supports 2 kinds of PCM banks: .PVI and .PZI

_(Make sure to do everything in the main [PCM](6PCM.md\#handling-pcm) page before proceeding with this guide)_

## Making a PVI File

.PVI is an ADPCM sample bank format which was used in FMP, both for its ADPCM playback and also the original PPZ driver, which was similar to PPS but allowed for PCM synthesis in all 3 SSG channels.

Being ADPCM means it was easy for KAJA to make a converter from the PPC banks, and the format is even supported by PMDB2. So the simplest way to make the PVI banks is to follow the [Making a PPC File](#making-a-ppc-file) guide then run the following program:

```
PPC2PVI <filename>.PPC
```

And it should output a file with the same name and the .PVI extension.

The problem with this method is that you lose on having the loop information in the PCM file itself, and the sample quality is significantly lower.

## Making a PZI File

### Preparing the Samples

First you need to get your samples ready. Open your samples in an audio editor, then:

- Resample them if they`re above 65533Hz

    The 86 Sounboard's playback rate is 44100, and PPZ will always play the file with the specified sample rate at o5c so it shouldn't be something to worry about.

- If it's a stereo sample, convert it to mono

    The converter doesn't support stereo samples.

- Export them as 16-bit unsigned RAW.
    
    In Audacity, this is done by going to "Export Audio...", choosing "Other uncompressed files" at the time of export, and then choosing "16-bit unsigned" and RAW (headerless).

I also recommend putting a brief moment of silence after the sample finishes to avoid potential clicks in the converted audio.

Save the samples individually in the workspace folder.

### Sample Conversion

Now we'll use PCMCONV to get them to the correct format.

In DOS, go to your workspace folder and use the following command:

```
pcmconv /w <input>.raw /b <output>.pc8
```

`/w` specifies the (input) file as a RAW 16-bit little-endian file, `/b` specifies the (output) file as 8-bit signed.

If for some reason you want to specify the sample rates you can do so after the file name:

```
pcmconv /v <input>.raw 44100 /b <input>.pc8 44100
```

### Packing it up in a PZI Bank

TAN-Y's PZIUTY tool uses an external text file for selecting and specifying the information of the samples. Create a text file in the DOS folder and open it in an editor.

The components of the file are as following:

```
#<PZI filename>
#<sample name>.pc8,<rate>,<loop start>,<loop end>
#<sample name>.pc8,<rate>,<loop start>,<loop end>
[...]
```

Spacing is not allowed and commas are needed between each value.

`<PZI filename>` is the name of the output file. You can include the extension or leave it without and it'll be added automatically.

`<sample name>` is the name of the sample file. Its position/instrument number is associated by the order it was inputted, from 1-127.

`<rate>` is the sample rate of the sample. Accepted range is 0-65533. It can be ommited, but PZIUTY will assume its base rate at 16504hz for .PC8 samples.

`<loop start>` and `<loop end>` are the loop positions of the sample, same as displayed on audacity when displaying audio position by samples. It can be omitted.

Save the file and change its extension to .TFI then run the following command:

```
pziuty l <filename>.tfi
```

And it should output a .PZI file.

## Sequencing and Commands

To enable use of PPZ8 in your MML and associate the channels, use the following header:

```
#PPZExtend  <letter(s)>
```

Any letter aside from the already assigned ones (ABCDEFGHIJKR) can be used for this, including lowercase. For example:

```
#PPZExtend  abc ; Channel a b and c will be used for PPZ8
```

PPZ8 supports up to 8 channels so you can input up to 8 letters. The lowercase a, b, c, d, e, f , g and h are the most common letters used for the PPZ8 channels.

To link your track to the .PZI file you're using, use the following header:

```
#PPZFile    <filename>.PZI
```

### Set instrument (`@<value>`)

To choose the PCM isntrument, use `@`, in which the value corresponds to the line order in the .LFI file. This is will make the sample play as-is once when a note is played.

### Set looped instrument (`@<value>,<start>,<end>`)

While the loop information can be contained in the PZI file itself, you can also specify it in the MML sequence.

However there's a limited range from -32768 (counting from the end of the sample) to +32767, so for longer samples it's recommended to specify the loop information in the file itself.

### Set volume envelope

You can set a volume envelope with the `E` command and it works as [specified before in the guide](4Chipcom.md\#volume-envelopes).

### Notes

As mentioned before, PPZ will always use the specified sample rate in the PZI file to play the note at `o5c`.

If you're using a pitched sample and its pitch is any note other than a C, it's recommended to use a global transposition `_M<value>` and/or global detune command `DD<value>` to pitch it accordingly.

Making a macro is advised if using multiple samples with different base pitches and volumes.

### Panning

While the ADPCM on the OPNA has hardpanning, the 86 Soundboard's PCM has full stereo control so like with PMD86, PPZ has an additional panning command allowing for the extended range, with `px<value>`

The value range is -4 to +4, in which the negative values pan torwards the left and the positive values pan to the right.

The normal `p<value>` pan command also works in PPZ, but it's also hardpanned.
